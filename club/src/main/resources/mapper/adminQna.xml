<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminQna">
	<!-- 전체 목록 조회 및 검색 조회까지 -->
	<select id="adminQnaList" resultType="adminQna.AdminQnaVO" parameterType="adminQna.AdminQnaVO">
		SELECT * FROM project.adminqna
		<include refid="search"></include>
		ORDER BY qna_re_ref DESC ,qna_re_seq ASC 
		limit #{startIndex},#{limit}
	</select>
	
	<!--  게시글 레코드 갯수 -->
	<select id="countArticle" resultType="integer">
		SELECT count(*) FROM project.adminqna
		<include refid="search"></include>
	</select>
	
	<!-- 반복되는 sql의 일부를 sql태그를 이용해서 뺄 수 있다. -->
	<sql id="search">
		<choose>
			<!-- 검색옵션이 전체 검색일 경우 -->
			<when test="searchOption =='all' and keyword != null and keyword != ''">
				WHERE qna_subject like '%${keyword}%'
				OR qna_content like '%${keyword}%' 
			</when>
			<!-- 전체 검색이 아닐 경우 -->
			<otherwise>
				<where>
					<if test="keyword != null and keyword != ''">
						${searchOption} like '%${keyword}%'
					</if>
				</where>
			</otherwise>
		</choose>
	</sql>

	<select id="count" resultType="integer" parameterType="adminQna.AdminQnaVO">
		SELECT count(*) FROM project.adminqna
		<where>
			<if test="keyword != null and keyword != ''">
				qna_name like '%${keyword}%' OR qna_num like '%${keyword}%' OR qna_subject like '%${keyword}%'
			</if>
		</where>
	</select>
	
	<insert id="adminQnaInsert" parameterType="adminQna.AdminQnaVO">
		INSERT INTO project.adminqna
		(qna_name, qna_subject, qna_content, qna_file, qna_re_ref, qna_re_lev, qna_re_seq, qna_readcount, qna_date)
		VALUES
		( #{qna_name},  #{qna_subject}, #{qna_content}, #{qna_file}, #{qna_re_ref}, 0, 0, 0, now())
	</insert>	
	
	<select id="maxQnaNum" resultType="integer">
		SELECT max(qna_num) + 1 FROM project.adminqna
	</select>
	
	<select id="adminQnaView" resultType="adminQna.AdminQnaVO" parameterType="integer">
		SELECT * FROM project.adminqna WHERE qna_num = #{qna_num}
	</select>
	
	<update id="adminQnaUpdate" parameterType="adminQna.AdminQnaVO">
		UPDATE project.adminqna SET
		qna_subject=#{qna_subject}, qna_content=#{qna_content}
		<if test="qna_file != null">
			, qna_file=#{qna_file}
		</if>
		WHERE qna_num=#{qna_num}
	</update>
	
	<delete id="adminQnaDelete" parameterType="integer">
		DELETE FROM project.adminqna WHERE qna_num=#{qna_num}
	</delete>
	
	<update id="updateReadcount" parameterType="integer">
		UPDATE project.adminqna SET qna_readcount = qna_readcount+1 WHERE qna_num=#{qna_num}
	</update>
	
	<select id="writerCheck" parameterType="adminQna.AdminQnaVO">
		SELECT * FROM project.adminqna WHERE qna_num=#{qna_num}
	</select>	
</mapper>