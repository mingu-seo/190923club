<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">
	
	<!-- 회원가입 -->
	<select id="idCheck" parameterType="String" resultType="Integer">
		SELECT COUNT(*) FROM project.member WHERE id=#{id}
	</select>
	
	<insert id="insertMember" parameterType="member.MemberVO">
		INSERT INTO project.member(id, password, name, email, birth, gender, tel, profile) 
		VALUES(
		#{id}, md5(#{password}), #{name}, #{email}, #{birth}, #{gender}, #{tel}, #{profile});
	</insert>

	
	<!-- 유저 로그인 -->
	<select id="userLogin" parameterType="member.MemberVO" resultType="member.MemberVO">
		SELECT * FROM project.member WHERE id=#{id} AND password=md5(#{password})
	</select>


	<!-- 마이페이지 -->
	<select id="mypageView" parameterType="Integer" resultType="member.MemberVO">
		SELECT * FROM project.member WHERE num=#{num}
	</select>
	
	<update id="mypageUpdate" parameterType="member.MemberVO">
		UPDATE project.member 
		SET name=#{name}, birth=#{birth}, gender=${gender}, email=#{email}, tel=#{tel}
		<if test="profile != null and profile != ''">
		, profile=#{profile}
		</if>
		WHERE num=#{num} 
	</update>
	
	
 	<!-- 전체 회원 리스트 -->    
	<select id="memberList" parameterType="member.MemberVO" resultType="member.MemberVO">
		SELECT * FROM project.member 
		<include refid="searchword"/>
		limit #{startIndex}, #{limit}
	</select> 
	
	
	<!-- 스팟 회원 리스트 --> 
	

	<!-- 페이징 처리 -->
	<select id="count" resultType="Integer" parameterType="member.MemberVO">
		SELECT count(*) FROM project.member
		<include refid="searchword"/>
	</select>
	
	<!-- 회원 검색 -->
	<sql id="searchword"> 
		<choose>
			<when test="searchword != null and searchword != '' and stype == 'all'">			
				WHERE name like '%${searchword}%'
				OR id like '%${searchword}%'
			</when>
			<when test="searchword != null and searchword != ''">
				WHERE ${stype} LIKE '%${searchword}%'
			</when>
		</choose>
	</sql>
</mapper>